<!DOCTYPE html>
<html lang="zh">
<head>
    <meta charset="UTF-8"/>
    <title>知识图谱可视化演示</title>
    <script src="https://d3js.org/d3.v7.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://cdn.jsdelivr.net/npm/particles.js"></script>
    <link rel="stylesheet" href="static/css/styles.css">
</head>
<body>
<div id="background"></div>
<div id="particles-js"></div>

<!-- 主工具栏 -->
<div id="main-toolbar">
    <div id="tab-menu">
        <button class="tab-button active" data-target="search-tab"><i class="fas fa-search"></i> 查询</button>
        <button class="tab-button" data-target="upload-tab"><i class="fas fa-file-upload"></i> 上传</button>
        <button class="tab-button" data-target="manage-tab"><i class="fas fa-network-wired"></i> 管理</button>
        <button class="tab-button" data-target="setting-tab"><i class="fas fa-cog"></i> 设置</button>
    </div>

    <div id="tab-content">
        <div class="toolbar-card tab-panel active" id="search-tab">
            <!-- 原查询部分 -->
            <div class="toolbar-section">
                <div class="section-title"><i class="fas fa-search"></i> 节点查询</div>
                <input type="text" id="searchInput" placeholder="输入关键词搜索..."/>
                <button onclick="handleSearch()" class="success"><i class="fas fa-search"></i> 查询节点</button>
                <button onclick="loadSelectedGraph()" class="secondary" style="margin-top: 12px;">
                    <i class="fas fa-times-circle"></i> 取消聚焦
                </button>
                <div class="section-title"><i class="fas fa-search"></i> 知识查询</div>
                <button class="success" id="knowledge-query-btn" style="margin-top:12px">
                    <i class="fas fa-robot"></i> 查询知识
                </button>


            </div>
        </div>

        <div class="toolbar-card tab-panel" id="upload-tab">
            <!-- 原上传部分 -->
            <div class="toolbar-section">
                <div class="section-title"><i class="fas fa-file-import"></i> 数据上传</div>
                <div class="file-upload-container">
                    <label class="file-upload-label" for="upload-file">
                        <i class="fas fa-cloud-upload-alt"></i>
                        <span>点击选择文件或拖放至此</span>
                    </label>
                    <input type="file" id="upload-file" class="file-upload-input" accept=".txt,.pdf,.docx,.json"/>
                    <div class="file-upload-name" id="file-name"></div>
                </div>
                <button onclick="handleUpload()">
                    <i class="fas fa-upload"></i> 上传图谱数据
                </button>
            </div>
        </div>

        <div class="toolbar-card tab-panel" id="manage-tab">
            <!-- 原图谱管理部分 -->
            <div class="toolbar-section">
                <div class="section-title"><i class="fas fa-network-wired"></i> 图谱管理</div>
                <select id="graphSelect">
                    <option value="" disabled hidden selected>请选择要加载的图谱</option>
                </select>
                <button onclick="loadSelectedGraph()"><i class="fas fa-sync"></i> 加载图谱</button>
            </div>
            <div class="toolbar-section">
                <button class="danger" onclick="handleDeleteGraph()"><i class="fas fa-trash"></i> 删除当前图谱</button>
                <button class="danger" onclick="handleDeleteByUser()"><i class="fas fa-trash-alt"></i> 删除全部图谱
                </button>
            </div>
        </div>

        <div class="toolbar-card tab-panel" id="setting-tab">
            <!-- 注销用户 -->
            <div class="toolbar-section">
                <div class="section-title"><i class="fas fa-sign-out-alt"></i> 用户</div>
                <button class="danger" onclick="DeleteUser()"><i class="fas fa-sign-out-alt"></i> 注销账号</button>
                <button onclick="logoutUser()"><i class="fas fa-sign-out-alt"></i> 退出登录</button>
            </div>

            <!-- 主题切换 -->
            <div class="toolbar-section">
                <div class="section-title"><i class="fas fa-adjust"></i> 主题</div>
                <button onclick="toggleTheme()">
                    <i class="fas fa-moon" id="theme-icon"></i>
                    <span id="theme-text">切换至深色模式</span>
                </button>
            </div>

            <!-- 粒子开关 -->
            <div class="toolbar-section">
                <div class="section-title"><i class="fas fa-star"></i> 粒子特效</div>
                <button onclick="toggleParticles()">
                    <i class="fas fa-star"></i>
                    <span id="particleToggleText">关闭粒子效果</span>
                </button>
                <button onclick="adjustParticles()" style="margin-top: 12px;">
                    <i class="fas fa-sliders-h"></i> 调整粒子数量
                </button>
            </div>
        </div>
    </div>
</div>

<!-- 导出下拉菜单 -->
<div class="export-dropdown">
    <button class="export-btn" id="export-btn">
        <i class="fas fa-download"></i>
        <span>导出与分享</span>
        <i class="fas fa-chevron-down"></i>
    </button>
    <div class="export-options" id="exportOptions">
        <button id="export-png-btn">
            <i class="fas fa-image"></i>
            <span>导出PNG图片</span>
        </button>
        <button id="export-json-btn">
            <i class="fas fa-file-code"></i>
            <span>导出JSON数据</span>
        </button>
        <button id="export-svg-btn">
            <i class="fas fa-file-image"></i>
            <span>导出SVG矢量图</span>
        </button>
        <button id="share-graph-btn">
            <i class="fas fa-share-alt"></i> 分享图谱链接
        </button>

    </div>
</div>

<!-- SVG 图谱 -->
<svg></svg>

<!-- 图例 -->
<div id="legend">
    <strong><i class="fas fa-map-marked-alt"></i> 实体类型图例</strong>
    <div class="legend-item">
        <span class="legend-color" style="background:#A8C5EB;"></span>
        Person (人物)
    </div>
    <div class="legend-item">
        <span class="legend-color" style="background:#F5B8C6;"></span>
        Organization (组织)
    </div>
    <div class="legend-item">
        <span class="legend-color" style="background:#9DD3F3;"></span>
        Location (地点)
    </div>
    <div class="legend-item">
        <span class="legend-color" style="background:#C7B3D2;"></span>
        Event (事件)
    </div>
    <div class="legend-item">
        <span class="legend-color" style="background:#A3D8E0;"></span>
        Concept (概念)
    </div>
    <div class="legend-item">
        <span class="legend-color" style="background:#F0C987;"></span>
        DATE (日期)
    </div>
    <div class="legend-item">
        <span class="legend-color" style="background:#B8D9A8;"></span>
        Number (数字)
    </div>
    <div class="legend-item">
        <span class="legend-color" style="background:#D8B3D8;"></span>
        Work (作品)
    </div>
</div>
<!-- 全屏助手浮层 -->
<div id="assistant-overlay" class="hidden">
    <div id="assistant-modal">
        <div id="assistant-avatar"></div>
        <input type="text" id="assistant-input" placeholder="请描述你想了解的知识..."/>
        <button id="assistant-send-btn"><i class="fas fa-paper-plane"></i> 发送</button>
        <button id="assistant-close-btn"><i class="fas fa-times"></i> 关闭</button>
    </div>
</div>

<script type="module" src="./js/app.js"></script>
<script>
    // 粒子配置
    const particlesConfig = {
        particles: {
            number: { value: 80, density: { enable: true, value_area: 800 } },
            color: { value: "#ffffff" },
            shape: { type: "circle" },
            opacity: { random: true, value: 0.5 },
            size: { random: true, value: 3 },
            line_linked: { enable: true, distance: 150, color: "#ffffff", opacity: 0.4, width: 1 },
            move: { enable: true, speed: 2, direction: "none", random: true, straight: false, out_mode: "out" }
        },
        interactivity: {
            detect_on: "canvas",
            events: {
                onhover: { enable: true, mode: "grab" },
                onclick: { enable: true, mode: "push" }
            }
        }
    };

    // 初始化粒子
    document.addEventListener('DOMContentLoaded', () => {
        particlesJS('particles-js', particlesConfig);
    });
</script>
</body>
</html>
